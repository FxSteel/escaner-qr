<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Escáner QR - Asistencia</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 30px; }
    #reader { width: 300px; margin: auto; }
  </style>
</head>
<body>
  <h1>Escanea tu código QR</h1>
  <div id="reader"></div>
  <p id="status">Esperando escaneo...</p>

  <script>
    function sendToWebhook(qrData) {
      fetch("https://steven2520.app.n8n.cloud/webhook/277fd813-69a5-4e3e-97bd-98d2255ac94c", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ codigo: qrData })
      })
      .then(res => {
        if (res.ok) {
          document.getElementById("status").textContent = "✅ Asistencia registrada con éxito";
        } else {
          document.getElementById("status").textContent = "❌ Error al registrar asistencia";
        }
      })
      .catch(() => {
        document.getElementById("status").textContent = "⚠️ Error de red";
      });
    }

    function onScanSuccess(decodedText, decodedResult) {
      document.getElementById("status").textContent = `Código leído: ${decodedText}`;
      sendToWebhook(decodedText);
      html5QrcodeScanner.clear();
    }

    const html5QrcodeScanner = new Html5QrcodeScanner(
      "reader", { fps: 10, qrbox: 250 });
    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>
